<span class="re0">$descriptor_spec</span> <span class="sy0">=</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">&#40;</span>
    <span class="nu0">0</span> <span class="sy0">=&gt;</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">&#40;</span><span class="st_h">'file'</span><span class="sy0">,</span> <span class="st_h">'test.php'</span><span class="sy0">,</span> <span class="st_h">'r'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="co1">//STDIN read mode from file (assuming that test.php exists at getcwd)</span>
    <span class="nu0">1</span> <span class="sy0">=&gt;</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">&#40;</span><span class="st_h">'pipe'</span><span class="sy0">,</span> <span class="st_h">'w'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="co1">//STDOUT write mode</span>
    <span class="nu0">2</span> <span class="sy0">=&gt;</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">&#40;</span><span class="st_h">'pipe'</span><span class="sy0">,</span> <span class="st_h">'w'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="co1">//STDERR write mode</span>
<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="re0">$cmd</span> <span class="sy0">=</span> <span class="st_h">'php'</span><span class="sy0">;</span>
<span class="re0">$cwd</span> <span class="sy0">=</span> <a href="http://www.php.net/getcwd"><span class="kw3">getcwd</span></a><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span> <span class="co1">//this directory needs to have a test.php</span>
&nbsp;
<span class="re0">$process</span> <span class="sy0">=</span> <a href="http://www.php.net/proc_open"><span class="kw3">proc_open</span></a><span class="br0">&#40;</span><span class="re0">$cmd</span><span class="sy0">,</span> <span class="re0">$descriptor_spec</span><span class="sy0">,</span> <span class="re0">$pipes</span><span class="sy0">,</span> <span class="re0">$cwd</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">if</span><span class="br0">&#40;</span><a href="http://www.php.net/is_resource"><span class="kw3">is_resource</span></a><span class="br0">&#40;</span><span class="re0">$process</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
&nbsp;
    <span class="co1">//notice we don't touch $pipes[0] because it's being handled as a file, it's not a stream IO to this parent script</span>
&nbsp;
    <span class="re0">$output</span> <span class="sy0">=</span> <a href="http://www.php.net/stream_get_contents"><span class="kw3">stream_get_contents</span></a><span class="br0">&#40;</span><span class="re0">$pipes</span><span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <a href="http://www.php.net/fclose"><span class="kw3">fclose</span></a><span class="br0">&#40;</span><span class="re0">$pipes</span><span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="re0">$errors</span> <span class="sy0">=</span> <a href="http://www.php.net/stream_get_contents"><span class="kw3">stream_get_contents</span></a><span class="br0">&#40;</span><span class="re0">$pipes</span><span class="br0">&#91;</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <a href="http://www.php.net/fclose"><span class="kw3">fclose</span></a><span class="br0">&#40;</span><span class="re0">$pipes</span><span class="br0">&#91;</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="re0">$exit_code</span> <span class="sy0">=</span> <a href="http://www.php.net/proc_close"><span class="kw3">proc_close</span></a><span class="br0">&#40;</span><span class="re0">$process</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="br0">&#125;</span>