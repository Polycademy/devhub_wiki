<span class="co1">//we don't need to specify STDIN, because we're just reading from this command</span>
<span class="re0">$descriptor_spec</span> <span class="sy0">=</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">&#40;</span>
<span class="nu0">1</span> <span class="sy0">=&gt;</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">&#40;</span><span class="st_h">'pipe'</span><span class="sy0">,</span> <span class="st_h">'w'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="co1">//STDOUT write mode</span>
<span class="nu0">2</span> <span class="sy0">=&gt;</span> <a href="http://www.php.net/array"><span class="kw3">array</span></a><span class="br0">&#40;</span><span class="st_h">'pipe'</span><span class="sy0">,</span> <span class="st_h">'w'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="co1">//STDERR write mode</span>
<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">//works on windows</span>
<span class="re0">$cmd</span> <span class="sy0">=</span> <span class="st_h">'tracert -w 10 accettura.com'</span><span class="sy0">;</span>
<span class="co1">//$cmd_on_linux = 'traceroute -w 10 accettura.com';</span>
&nbsp;
<span class="re0">$process</span> <span class="sy0">=</span> <a href="http://www.php.net/proc_open"><span class="kw3">proc_open</span></a><span class="br0">&#40;</span><span class="re0">$cmd</span><span class="sy0">,</span> <span class="re0">$descriptor_spec</span><span class="sy0">,</span> <span class="re0">$pipes</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">if</span><span class="br0">&#40;</span><a href="http://www.php.net/is_resource"><span class="kw3">is_resource</span></a><span class="br0">&#40;</span><span class="re0">$process</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
&nbsp;
    <span class="co1">//there are two ways to do this, but both uses output buffering (use one or the other, delete one of them)</span>
&nbsp;
    <span class="co1">//first way</span>
    <span class="co1">//test for the end of output and loop through this block whenever it hasn't reached the end</span>
    <span class="kw1">while</span><span class="br0">&#40;</span><span class="sy0">!</span><a href="http://www.php.net/feof"><span class="kw3">feof</span></a><span class="br0">&#40;</span><span class="re0">$pipes</span><span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
        <span class="co1">//get output line by line</span>
        <span class="re0">$output</span> <span class="sy0">=</span> <a href="http://www.php.net/fgets"><span class="kw3">fgets</span></a><span class="br0">&#40;</span><span class="re0">$pipes</span><span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="kw1">echo</span> <span class="re0">$output</span><span class="sy0">;</span>
        <span class="co1">//flush the output buffer and destroy the buffer</span>
        <span class="co1">//these basically passes the content to the client even though the script hasn't finished</span>
        <a href="http://www.php.net/ob_flush"><span class="kw3">ob_flush</span></a><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <a href="http://www.php.net/flush"><span class="kw3">flush</span></a><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co1">//second way</span>
    <span class="co1">//extract a line equivalent to 4096 bytes (4kb), this is an arbitrary figure, and do this continuously</span>
    <span class="co1">//until fgets can no longer get any more output and equates to false</span>
    <span class="kw1">while</span><span class="br0">&#40;</span><span class="br0">&#40;</span><span class="re0">$output</span> <span class="sy0">=</span> <a href="http://www.php.net/fgets"><span class="kw3">fgets</span></a><span class="br0">&#40;</span><span class="re0">$pipes</span><span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="sy0">,</span> <span class="nu0">4096</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">!==</span> <span class="kw4">false</span><span class="br0">&#41;</span><span class="br0">&#123;</span>
        <span class="co1">//flush the output buffer</span>
        <span class="kw1">echo</span> <span class="re0">$output</span><span class="sy0">;</span>
        <a href="http://www.php.net/ob_flush"><span class="kw3">ob_flush</span></a><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <a href="http://www.php.net/flush"><span class="kw3">flush</span></a><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
&nbsp;
    <a href="http://www.php.net/fclose"><span class="kw3">fclose</span></a><span class="br0">&#40;</span><span class="re0">$pipes</span><span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="re0">$errors</span> <span class="sy0">=</span> <a href="http://www.php.net/stream_get_contents"><span class="kw3">stream_get_contents</span></a><span class="br0">&#40;</span><span class="re0">$pipes</span><span class="br0">&#91;</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <a href="http://www.php.net/fclose"><span class="kw3">fclose</span></a><span class="br0">&#40;</span><span class="re0">$pipes</span><span class="br0">&#91;</span><span class="nu0">2</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="re0">$exit_code</span> <span class="sy0">=</span> <a href="http://www.php.net/proc_close"><span class="kw3">proc_close</span></a><span class="br0">&#40;</span><span class="re0">$process</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="br0">&#125;</span>